#include <iostream>
#include <fstream> // acesso a biblioteca com as funções que permitem o uso dos arquivos
#include <locale.h> // permitir a acentuação
#include <cstring>
#include <cstdlib>

using namespace std;

struct Img{
    int linhas;
    int colunas;
    int M[512][512][3];
};

void abre_img(char nome[], Img& img){
    fstream arq;

    int  pixels, k=0;
    char tipo[3]; // declara uma variavel char para armazenar o tipo da imagem

    arq.open(nome);

    if(arq.is_open()){
        //cout << "Está aberto!\n";
        arq.getline(tipo, 3);
        if(strcmp("P3",tipo)!=0){
            cout<<"ERRO\n";
            exit(0);
        }
        arq >> img.colunas;
        arq >> img.linhas;
        arq>> pixels;

        int i, j;

        for(i=0; i<img.linhas; i++){
            for(j=0; j<img.colunas; j++){
               for(k=0; k<3; k++){
                    arq >> img.M[i][j][k];
               }
            }
        }
        arq.close();
    }

    else{
        cout << "Não está aberto!\n";
    }
}
void salva_img(char nome[],Img img){
    ofstream myfile;

    myfile.open(nome);

    if(myfile.is_open()){
        myfile << "P3"<<endl;

        myfile << img.colunas << " " << img.linhas << "\n" << 255 << endl;

        int i, j,k;

        for(i=0; i<img.linhas; i++){
            for(j=0; j<img.colunas; j++){
               for(k=0; k<3; k++){
                    myfile << img.M[i][j][k] << " ";
               }
            }

            myfile << endl;
        }
        myfile.close();
    }

    else{
        cout << "Não está aberto!\n";
    }
}

int main()
{
    setlocale(LC_ALL, "Portuguese"); // permite a utilização de acentos provenientes da lingua portuguesa
    Img img;

    char nome[]="lake.ppm";

    //cout << "Informe o nome do arquivo que vc deseja abrir: " << endl;

    abre_img(nome, img);
    salva_img("Saida.ppm",img);

    return 0;
}
